<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>帅气的吴先生 | 帅气的吴先生</title><meta name="author" content="子曰"><meta name="copyright" content="子曰"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="web溯源三两事（ps：以下案例均来自攻防演练真实案例，涉及到单位及个人隐私的敏感信息已全部打码）（再ps：本案例不适用于各路神仙打架的情况） 0x00 为什么有这篇文章在省厅或地市级的攻防演练当中，蓝队总是很被动地进行防守，每次演练时都特别讨厌明知道有人在扫描探测，却不能封堵IP那种有心无力的感觉（地市级的演练承办单位没有过多的跳板机或IP资源池，GA要求不能封IP的情况特别多）。而众所周知，在">
<meta property="og:type" content="article">
<meta property="og:title" content="帅气的吴先生">
<meta property="og:url" content="https://ziyue0230.top/2021/08/web%E6%BA%AF%E6%BA%90%E4%B8%89%E4%B8%A4%E4%BA%8B/index.html">
<meta property="og:site_name" content="帅气的吴先生">
<meta property="og:description" content="web溯源三两事（ps：以下案例均来自攻防演练真实案例，涉及到单位及个人隐私的敏感信息已全部打码）（再ps：本案例不适用于各路神仙打架的情况） 0x00 为什么有这篇文章在省厅或地市级的攻防演练当中，蓝队总是很被动地进行防守，每次演练时都特别讨厌明知道有人在扫描探测，却不能封堵IP那种有心无力的感觉（地市级的演练承办单位没有过多的跳板机或IP资源池，GA要求不能封IP的情况特别多）。而众所周知，在">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg">
<meta property="article:published_time" content="2021-08-08T17:10:13.680Z">
<meta property="article:modified_time" content="2020-12-03T09:31:06.000Z">
<meta property="article:author" content="子曰">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://ziyue0230.top/2021/08/web%E6%BA%AF%E6%BA%90%E4%B8%89%E4%B8%A4%E4%BA%8B/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '帅气的吴先生',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2020-12-03 17:31:06'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/Blog/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">2</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">帅气的吴先生</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">无题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-08-08T17:10:13.680Z" title="发表于 2021-08-09 01:10:13">2021-08-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-12-03T09:31:06.000Z" title="更新于 2020-12-03 17:31:06">2020-12-03</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="web溯源三两事"><a href="#web溯源三两事" class="headerlink" title="web溯源三两事"></a>web溯源三两事</h1><p><em>（ps：以下案例均来自攻防演练真实案例，涉及到单位及个人隐私的敏感信息已全部打码）</em><br><em>（再ps：本案例不适用于各路神仙打架的情况）</em></p>
<h2 id="0x00-为什么有这篇文章"><a href="#0x00-为什么有这篇文章" class="headerlink" title="0x00 为什么有这篇文章"></a>0x00 为什么有这篇文章</h2><p>在省厅或地市级的攻防演练当中，蓝队总是很被动地进行防守，每次演练时都特别讨厌明知道有人在扫描探测，却不能封堵IP那种有心无力的感觉（地市级的演练承办单位没有过多的跳板机或IP资源池，GA要求不能封IP的情况特别多）。而众所周知，在防守方攻防演习规则中，发现扫描类攻击行为是不给分的，于是我们可以把精力集中在一个有趣又容易拿分的地方，见下：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987677_20201203102502264_29393.png"><br>溯源是通过分析已知的攻击痕迹，完整还原攻击链条，并找到攻击者的虚拟身份、真实身份，溯源到攻击队员，或反控攻击方主机的一个过程，一般来说在最理想情况下，我们需要得到攻击者的以下身份信息：</p>
<ul>
<li>攻击IP</li>
<li>地理位置</li>
<li>木马路径</li>
<li>IP地址所属的公司</li>
<li>IP地址所关联的域名</li>
<li>邮箱</li>
<li>虚拟身份</li>
<li>手机号</li>
<li>真实姓名</li>
<li>身份证号</li>
<li>人物照片</li>
<li>所在公司</li>
</ul>
<p>于是，我想先分享三个真实溯源案例，再总结一下过程中所使用的小tricks，为各位防守大大们提供一些溯源思路。  </p>
<p><strong>感谢同部门小伙伴为我的学习之路提供帮助，贴出他的book主页：<a target="_blank" rel="noopener" href="http://greatagain.dbappsecurity.com.cn/#/book/search/rank/user?id=997">http://greatagain.dbappsecurity.com.cn/#/book/search/rank/user?id=997</a></strong></p>
<h2 id="0x01-案例一：蜜罐"><a href="#0x01-案例一：蜜罐" class="headerlink" title="0x01 案例一：蜜罐"></a>0x01 案例一：蜜罐</h2><p>设计蜜罐的初衷就是让黑客入侵，借此收集证据，攻击者踩到蜜罐则是溯源最幸运的一种情况。见以下案例。  </p>
<p>某个风和日丽的午后，17:17开始收到安全设备告警，捕捉到攻击者的陆续攻击行为：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987679_20201203111609601_32309.png"></p>
<p>好巧不巧，IP地址 x.x.x.68 为防守单位部署的我司蜜罐，查看蜜罐日志，该设备不负众望地识别出攻击者画像，捕获到该攻击者的 <code>微博ID</code> ：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987680_20201203112224679_17821.png"></p>
<p>微博搜索该ID，用户名为 <code>xx绕城</code> ，该攻击者于2018年转发了黑客相关的文章。说明该微博ID所属者具备黑客技能：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987680_20201203112442934_7030.png"></p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987680_20201203112535087_20193.png"></p>
<p>在CSDN搜索到 <code>xx绕城</code> 的博客ID： <code>xxxxxwall</code> ，发表的文章为渗透相关，且该攻击者具有一定编程能力。</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987681_20201203112737067_25450.png"></p>
<p><code>Github</code> 搜索发现攻击者编写的jsp webshell，得到QQ号为： <code>xxxxx0588</code> ，查询该QQ昵称同样为 <code>xx绕城</code> ：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987681_20201203113858511_28773.png"></p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987682_20201203114027973_9444.png"></p>
<p>看来 <code>xx绕城</code> 为该作者常用昵称，且极有可能从事安全相关的工作，既然一切的发源始于微博ID，那我们同样再次在微博上查找关于此人相关的信息。  </p>
<p>微博搜索 <code>xx绕城</code> ，可以发现此人为某安全杂志作者，且标注了真实姓名 <code>x雷</code> ：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987683_20201203115446501_899.png"></p>
<p>从杂志中可以发现该作者较为详细的信息，包括 <code>籍贯、真实姓名、照片、Email、年龄</code> 等：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987684_20201203120157387_2047.png"></p>
<p>该Email中的QQ号与之前的QQ号对应，且籍贯相同，确定为同一人。<br>当然，根据该杂志的出版时间，结合作者年龄可以大概推算出生年份，不过没有具体的日期也没什么意义了，此次溯源到此告一段落。<br>总结：<br>|   key  |  value   |<br>| :– | :– |<br>|   攻击者IP  |   x.x.46.51  |<br>|    微博ID |   xxxxxx0343  |<br>|    QQ |   xxxxx0588  |<br>|   常用昵称  |   xx绕城  |<br>|   博客ID  |   xxxxxwall  |<br>|  邮箱地址  |  <a href="mailto:&#120;&#120;&#120;&#120;&#120;&#48;&#x35;&#x38;&#x38;&#103;&#115;&#x72;&#x63;&#x40;&#x71;&#113;&#x2e;&#x63;&#x6f;&#x6d;">&#120;&#120;&#120;&#120;&#120;&#48;&#x35;&#x38;&#x38;&#103;&#115;&#x72;&#x63;&#x40;&#x71;&#113;&#x2e;&#x63;&#x6f;&#x6d;</a> |<br>|   真实姓名  |   x雷  |<br>|   籍贯  |  河北保定 |</p>
<h2 id="0x02-案例二：云服务器"><a href="#0x02-案例二：云服务器" class="headerlink" title="0x02 案例二：云服务器"></a>0x02 案例二：云服务器</h2><p>出于反弹shell，或者跳板攻击的需要，攻击者常常会使用到自己的VPS。云服务商在为我们提供便捷的同时，或多或少也都存在一些安全隐患，变相泄露租户隐私，或为有心者提供便利的查询渠道。</p>
<p>还是一个风和日丽的午后，一名攻击者对我方资产进行漏洞扫描攻击，攻击次数10738次。</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987684_20201203122037643_14479.png"></p>
<p>该IP开放了8443端口，并搭建了Acunetix 漏洞扫描器：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987685_20201203122203312_27719.png"></p>
<p>查询该IP，位于四川成都的IDC服务器，是一台 <code>腾讯云</code> 的云主机：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987686_20201203122409016_15267.png"></p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987686_20201203122425583_10999.png"></p>
<p>这里要说到，不管是腾讯云还是阿里云，都为各租户提供了一个便捷通道，“忘记账号”，当然这条通道也为我们的溯源之路提供莫大的帮助：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987687_20201203122706151_11762.png"></p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987688_20201203122853215_7154.png"></p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987687_20201203122825108_6853.png"></p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987688_20201203122942685_22303.png"></p>
<p>这条通道可以为我们提供：</p>
<ul>
<li>手机号验证</li>
<li>域名验证</li>
<li>实名信息验证</li>
</ul>
<p>使用腾讯云的服务器IP找回功能，可以发现该IP绑定的电话号码为 <code>184****6377</code> ：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987692_20201203125637230_9302.png"></p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987689_20201203123224599_20717.png"></p>
<p>腾讯云最大的失败就是只隐藏了中间四位数字，总共只有10000种可能性，使用脚本生成10000个手机号码后进行空号清洗，基本上去掉近 7/8 的空号或失效号。</p>
<p>这里顺便贴一下小伙伴的文章：<a target="_blank" rel="noopener" href="http://greatagain.dbappsecurity.com.cn/#/book/search/detail?id=6728&type=1">http://greatagain.dbappsecurity.com.cn/#/book/search/detail?id=6728&amp;type=1</a></p>
<p>而且腾讯云刚好又能检测一个手机号是否开通了云主机，如下：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987690_20201203124222780_27440.png"></p>
<p>只是比较蛋疼的是每次都需要拖动一个图片验证码，这样一来工作量就提升了一个档次，如下：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987691_20201203124811183_10323.png"></p>
<p>不过这也不是无解的，曾看到一篇介绍使用 <code>python</code> 的 <code>selenium</code> 模块进行自动登录的文章，有兴趣的小伙伴可以自行研究一下：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/l7DbdlDJtBudqojdbfnyOg">https://mp.weixin.qq.com/s/l7DbdlDJtBudqojdbfnyOg</a></p>
<p>通过上千次重复的验证过程，发现了好几个绑定过腾讯云的相似手机号，而根据服务器IP进行找回可以验证该手机号是否属于此IP，终于皇天不负有心人，找到属于 <code>山西太原移动</code> 的手机号：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987692_20201203125818528_20600.png"></p>
<p>通过添加该手机号为联系人，在钉钉通讯录功能中确定其名字为 <code>x锦源</code> :</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987693_20201203130029396_31805.png"></p>
<p>百度 <code>x锦源</code> ，第一条就是CISAW风险管理方向考试合格人员名单，其中泄露了他的工作单位为 <code>中国xxxx研究院</code> ，该单位正好参演了本次hw演练：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987713_20201203160746789_14579.png"></p>
<p>通过信息安全等级测评师也可查询到其信息：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987713_20201203160807579_1464.png"></p>
<p>有了手机号，一切就好办多了，通过手机号搜索微信名为： <code>xxxx stars</code></p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987693_20201203130832740_22342.png"></p>
<p>祭出社工库，可查询到他的 <code>微博地址</code> 和 <code>QQ邮箱</code> ：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987694_20201203131229668_24563.png"></p>
<p>微博中发现所在地： <code>山西 临汾</code>  生日： <code>1993年6月10日</code> ：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987695_20201203131336810_23581.png"></p>
<p>翻看历史微博，能够找到其毕业大学：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987695_20201203131441140_21597.png"></p>
<p>QQ号为 ： <code>xxxxx3392</code> ，名为 <code>xxxxxx_M</code> ，留言板发现情侣名为 <code>xxxxxx_L</code> ，通过查看QQ空间的说说查到xxxxxx_M和xxxxxx_L有互动，确定为情侣关系。</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987696_20201203132331706_26430.png"></p>
<p>从QQ空间和空间相册，可以确定x锦源户籍所在地为：<code>山西 临汾 翼城</code> 及本人照片：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987696_20201203131938713_934.png"></p>
<p>于此，溯源工作又告一段落。</p>
<p>总结：<br>| key    | value    |<br>| :– | :– |<br>|   攻击IP  |  x.x.57.146 成都腾讯云服务器   |<br>|   手机号  |  184xxxx6377   |<br>|   微信名  |   xxxx stars  |<br>|   微博ID  |   xxxxxx5052  |<br>|   QQ号  |   xxxxx3392  |<br>|   毕业院校  |   中北大学信息商务学院  |<br>|   籍贯  |   山西 临汾 翼城  |<br>|   现就职  |   中国xxxx研究院  |</p>
<h2 id="0x03-案例三：域名"><a href="#0x03-案例三：域名" class="headerlink" title="0x03 案例三：域名"></a>0x03 案例三：域名</h2><p>这里不得不吐槽在阿某云上购买的域名，个人注册的域名去查<code>whois</code>可能会发现一些不得了的东西：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987697_20201203133649390_27632.png"></p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987697_20201203133735498_23174.png"></p>
<p>还是在一个风和日丽的午后，x.x.55.20对我方服务器发起漏洞攻击，查询IP为腾讯云服务器，老手段找到打了码的 <code>手机号 153****0158</code>，此为铺垫：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987706_20201203151807335_3548.png"></p>
<p>查询威胁情报直接可以反查到该IP绑定的域名了：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987698_20201203134506254_15170.png"></p>
<p><code>whois</code>反查，可以查询到联系人姓名“x东林”：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987698_20201203134732955_20241.png"></p>
<p>注册人反查可查询到“x东林”只注册了一个域名，由此可以判断此注册人不是注册商员工，大概率是注册此域名的使用者真实姓名：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987699_20201203134932467_10482.png"></p>
<p>根据其域名地址找到了他的个人博客，于是昵称有了——xxxxx9e、x歌： </p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987700_20201203144718210_9789.png"></p>
<p>在博客“关于我”板块中，有攻击者相关信息，包括 <code>团队/小组、Email、微博</code> 等：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987700_20201203145035192_13623.png"></p>
<p>搜索“枫林信息安全小组”，可知其为 <code>西南交通大学</code> 信息安全小组，和上面说的 <code>交大</code> 对上了：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987701_20201203145357161_14196.png"></p>
<p>继续由微博深入，微博名称： <code>xxxxx9e</code> ，大V认证 WSRC中级安全研究员，又是个大佬：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987701_20201203150108552_19949.png"></p>
<p>翻看微博UID：xxxxxx2520，通过社工库查询到其 <code>手机号 180xxxx3442</code>：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987702_20201203150326617_29412.png"></p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987703_20201203150440024_19209.png"></p>
<p>接下来还是老手段，将其手机号保存为通讯录联系人，然后通过钉钉、微信、QQ的通讯录功能查询该攻击者的虚拟身份信息：</p>
<p><code>微信名：xxxxx9e</code></p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987704_20201203150710537_11502.png"></p>
<p>通过支付宝转账功能，确认其名字为 <code>x东林</code> ，顺便还有个163邮箱，根据上面的信息也能猜出邮箱地址 <code>xxxxx9e@163.com</code>了：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987705_20201203150832462_18930.png"></p>
<p>接下来两步溯源过程其实都挺脑洞的，突然感慨有时候生活中还是需要一些奇思妙想。</p>
<p>在微博中可看到他悄悄关注了某盟SRC，向小伙伴求助，他一打听某盟还在真存在这么一位大神：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987705_20201203151523302_26048.png"></p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987705_20201203151546729_18679.png"></p>
<p>还记得上面查询到的手机号么，通过IP查询到的手机号，和通过社工库查询到的手机号竟然不是同一个，但两个途径溯源到的，都是一个叫“x东林”的人。判断有两个手机号，但是通过IP查找到的手机号又有让人犯强迫症的马赛克：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987706_20201203151807335_3548.png"></p>
<p>我们知道，电话号码的组成是 <strong>第1-3位—网络识别号；第4-7位—地区编码；第8-11位—用户号码</strong>，所以我们只要知道地区编码就能猜解手机号了。</p>
<p>起初，不管是从学校，还是从keep推敲出的小区地址，我都以为该手机号是成都号段：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987706_20201203152754450_31808.png"></p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987707_20201203152838820_8145.png"></p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987707_20201203152900203_14099.png"></p>
<p>成都153：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987708_20201203153207670_29844.png"></p>
<p>可之后不管我怎么验证，都不能和他所使用的攻击IP地址对应上，这就让我纳闷儿了，浪费了好长一段时间还没得到正解。</p>
<p>正在山重水复疑无路的时候，小伙伴又带来了柳暗花明又一村：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987708_20201203153543439_26416.png"></p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987709_20201203153654647_8995.png"></p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987709_20201203153747428_15461.png"></p>
<p>说实话，我当时人都麻了=。=：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987710_20201203153957275_12290.png"></p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987710_20201203154039960_25331.png"></p>
<p>陇南153电信：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987710_20201203154109703_31988.png"></p>
<p>IP和手机号对比成功。完整<code>手机号：153xxxx0158</code> 到手。</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987711_20201203154134640_16869.png"></p>
<p>通过180的手机号查询社工库，可以得到其绑定的 <code>QQ xxxxx1549</code>：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987711_20201203154452582_30695.png"></p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987711_20201203154527735_20049.png"></p>
<p>根据 QQ 号码查询社工库，同样能找到其绑定的另一个 <code>手机号 153xxxx0816</code>， 于此，就找到攻击者的3个手机号信息了：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987712_20201203154752108_3313.png"></p>
<p>接下来是找照片，还是以微博为突破口，翻出其久远的纪念照两张，通过人脸对比，该位大神的真容也逐渐浮出水面：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987712_20201203155139587_18923.png"></p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987712_20201203155210495_11552.png"></p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987713_20201203155234558_26375.png"></p>
<p>到此，溯源工作又告一段落。</p>
<p>总结：<br>| key    | value    |<br>| :– | :– |<br>|  姓名   |  x东林   |<br>|  手机号   |  180xxxx3442   |<br>|     |   153xxxx0158  |<br>|     |   153xxxx0816  |<br>|   微博  |  xxxxx9e   |<br>|  钉钉   |  xxxxx9e   |<br>|   微信  |   xxxxx9e  |<br>|   QQ号  |   xxxxx1549  |<br>|  QQ昵称   |   xxxxx9e  |<br>|  邮箱地址 |  <a href="mailto:&#x78;&#120;&#x78;&#x78;&#x78;&#x39;&#x65;&#64;&#x31;&#x36;&#51;&#x2e;&#99;&#111;&#x6d;">&#x78;&#120;&#x78;&#x78;&#x78;&#x39;&#x65;&#64;&#x31;&#x36;&#51;&#x2e;&#99;&#111;&#x6d;</a> |<br>|    |   <a href="mailto:&#114;&#111;&#x6f;&#116;&#x40;&#x78;&#x78;&#x78;&#x78;&#120;&#103;&#101;&#46;&#99;&#x6f;&#x6d;">&#114;&#111;&#x6f;&#116;&#x40;&#x78;&#x78;&#x78;&#x78;&#120;&#103;&#101;&#46;&#99;&#x6f;&#x6d;</a> |<br>|   学校  |   西南交通大学  |<br>|   籍贯  |   甘肃陇南  |<br>|   常驻住址  |  名著司南   |<br>|   就职公司  |  x盟  |</p>
<h2 id="0x04-关于身份证"><a href="#0x04-关于身份证" class="headerlink" title="0x04 关于身份证"></a>0x04 关于身份证</h2><p>各位观众老爷也许都注意到了，上面三个案例中都没溯源出攻击者身份证信息。这是因为，<strong>这玩意儿真的是在太难找了！</strong></p>
<p>本人目前能想到的方法只有：<br>1、通过某些网站的信息泄露，如社工库等<br>2、通过本人主动泄露信息，如微博、QQ空间等<br>3、通过某些网站的身份比对，如腾讯云、学信网等  </p>
<p>这里可以为大家提供一种思路，去溯源到攻击者的身份证信息。以上面案例二作为例子：</p>
<p><strong>我们知道，身份证的组成结构如下：</strong><br><strong>- 1、2位是省、自治区、直辖市代码</strong><br><strong>- 3、4位是地级市、盟、自治州代码</strong><br><strong>- 5、6位是县、县级市、区代码</strong><br><strong>- 7至14位是出生年月日</strong><br><strong>- 15、16为顺序号</strong><br><strong>- 17位一般数字男为单数，女为双数</strong><br><strong>- 18位为校验码</strong><br><strong>- 数字为0-9和X</strong></p>
<p>由案例二我们已经知道，该攻击者的籍贯为 <code>山西省临汾市翼城县</code>，可确定身份证前六位为 <code>141022</code>：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987713_20201203163119209_21369.png"></p>
<p>接下来需要确定该攻击者的出生年月日，我们在微博和QQ上可找到相关信息。</p>
<p>微博生日显示为“1993年6月10日”，该日期农历日期为“四月廿一”：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987714_20201203163425070_6905.png"></p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987714_20201203163435918_2907.png"></p>
<p>QQ空间留言板上生日为“2014年5月19日”，该日期农历同样为“四月廿一”：</p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987715_20201203163610287_6655.png"></p>
<p><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/1606987716_20201203163636894_29032.png"></p>
<p>可确定其微博上的生日<strong>极大概率</strong>为真实生日（除了出生年份不确定）。于案例二溯源过程中可知该攻击者2014年于 中北大学信息商务学院毕业，一般正常人不停学不留级，按三年学制算，到大学毕业时大概年龄21-22岁，也比较符合其于1993年出生。于是身份证第7到14位暂定为 <code>19930610</code></p>
<p>这样一来，男生第17位可能为<strong>1、3、5、7、9</strong>，第18位校验码由前面17位数字生成，第15-16位不确定，总共大概 <code>500</code> 种可能性。</p>
<p>通过身份信息校验接口比对，是有可能找到攻击者的身份证信息的。本人太懒实在不想操作了，各位大佬如果有更好的关于溯源身份证信息的方法的话，也望不吝赐教。</p>
<h2 id="0x05-总结"><a href="#0x05-总结" class="headerlink" title="0x05 总结"></a>0x05 总结</h2><p>通过以上案例分享，总结出我们在演练时溯源可以使用的手段：</p>
<ul>
<li>安全设备攻击源捕获：威胁发现与阻断、蜜罐、攻击者画像…</li>
<li>IP信息定位：IP2Location、IP反查</li>
<li>信息比对：手机号确认、IP与手机号比对、真实身份比对…</li>
<li>ID追踪：搜索引擎、社交平台、技术论坛、社工库…</li>
<li>域名追踪：whois、注册人</li>
<li>社交帐号：虚拟身份（ID、昵称）、联系方式（邮箱、QQ、手机号）、组织情况（单位、职位、姓名、住址）等</li>
</ul>
<p>其实溯源工作也是社会工程运用的一部分，关键在于如何通过组织零散的已知信息还原完整的攻击者身份。以上拙见，望大佬们轻批。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">子曰</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://ziyue0230.top/2021/08/web%E6%BA%AF%E6%BA%90%E4%B8%89%E4%B8%A4%E4%BA%8B/">https://ziyue0230.top/2021/08/web%E6%BA%AF%E6%BA%90%E4%B8%89%E4%B8%A4%E4%BA%8B/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">未经作者允许禁止转载！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2021/08/hello-world/"><img class="next-cover" src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Hello World</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://wl-1301085254.cos.ap-chengdu.myqcloud.com/Blog/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">子曰</div><div class="author-info__description">积土成山，积水成渊，净水流深</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">2</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ziyue0230"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">暂时还没有公告哦^_^</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#web%E6%BA%AF%E6%BA%90%E4%B8%89%E4%B8%A4%E4%BA%8B"><span class="toc-number">1.</span> <span class="toc-text">web溯源三两事</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x00-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%9C%89%E8%BF%99%E7%AF%87%E6%96%87%E7%AB%A0"><span class="toc-number">1.1.</span> <span class="toc-text">0x00 为什么有这篇文章</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-%E6%A1%88%E4%BE%8B%E4%B8%80%EF%BC%9A%E8%9C%9C%E7%BD%90"><span class="toc-number">1.2.</span> <span class="toc-text">0x01 案例一：蜜罐</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-%E6%A1%88%E4%BE%8B%E4%BA%8C%EF%BC%9A%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.3.</span> <span class="toc-text">0x02 案例二：云服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-%E6%A1%88%E4%BE%8B%E4%B8%89%EF%BC%9A%E5%9F%9F%E5%90%8D"><span class="toc-number">1.4.</span> <span class="toc-text">0x03 案例三：域名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-%E5%85%B3%E4%BA%8E%E8%BA%AB%E4%BB%BD%E8%AF%81"><span class="toc-number">1.5.</span> <span class="toc-text">0x04 关于身份证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x05-%E6%80%BB%E7%BB%93"><span class="toc-number">1.6.</span> <span class="toc-text">0x05 总结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/08/web%E6%BA%AF%E6%BA%90%E4%B8%89%E4%B8%A4%E4%BA%8B/" title="无题"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2021/08/web%E6%BA%AF%E6%BA%90%E4%B8%89%E4%B8%A4%E4%BA%8B/" title="无题">无题</a><time datetime="2021-08-08T17:10:13.680Z" title="发表于 2021-08-09 01:10:13">2021-08-09</time></div></div><div class="aside-list-item"><div class="content"><a class="title" href="/2021/08/hello-world/" title="Hello World">Hello World</a><time datetime="2021-08-06T09:44:26.001Z" title="发表于 2021-08-06 17:44:26">2021-08-06</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By 子曰</div><div class="footer_custom_text">你那么可爱，打赏一个再走叭(*/ω＼*)</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>